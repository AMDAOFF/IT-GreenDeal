@page "/infoscreen"
@model Canteen.Web.Pages.Student.InfoScreenModel

@using QRCoder 
@using System.Drawing
@using System.IO
@using Service.DishService.Dto;

@{ 
    byte[] ConvertBitmapToBytes(Bitmap bitmap)
    {
        using (MemoryStream memoryStream = new MemoryStream())
        {
            bitmap.Save(memoryStream, System.Drawing.Imaging.ImageFormat.Png);
            return memoryStream.ToArray();
        }
    }
}

<div class="infoscreen-container">
    <div class="p-2">
        <div class="col-3">
            <div class="row">
                <div class="col-3 d-flex justify-content-center">
                    <img src="https://www.energycluster.dk/wp-content/uploads/2020/12/EUC-Syd.jpg" class="infoscreen-icon" />
                </div>

                <div class="col-8 infoscreen-header-info">
                    <div class="infoscreen-header-info-content">
                        <h3 class="text-bold">Kantinen (EUC Syd)</h3>
                        <h3>12:00</h3>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-9"></div>
    </div>

    <div class="m-5">
        <div class="row mr-auto">
            @foreach (FullDishDTO dish in Model.DishesToday)
            {
                <div class="col-4">
                    <div class="infoscreen-dish-item">
                        <div class="infoscreen-dish-item-header">
                            <h2>@dish.DishName</h2>
                        </div>

                        <div class="infoscreen-dish-item-footer">
                            <div class="row">
                                <div class="col-8">
                                    <h5>Scan koden for mere information</h5>
                                </div>

                                <div class="col-4">
                                    @{
                                        string dishUrl = Model.BaseUrl + "dishinfo/" + dish.DishId;
                                        QRCodeGenerator qrCodeGenerator = new QRCodeGenerator();
                                        QRCodeData qrCodeData = qrCodeGenerator.CreateQrCode(dishUrl, QRCodeGenerator.ECCLevel.Q);
                                        QRCode qrCode = new QRCode(qrCodeData);
                                        Bitmap bitmap = qrCode.GetGraphic(30);
                                        var bitmapBytes = ConvertBitmapToBytes(bitmap); //Convert bitmap into a byte array

                                    }

                                    <img width="100px" src="@String.Format("data:image/png;base64,{0}", Convert.ToBase64String(File(bitmapBytes, "image/jpeg").FileContents))" />
                                </div>
                            </div
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>